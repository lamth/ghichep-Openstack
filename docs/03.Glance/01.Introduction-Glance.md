# Giới thiệu về Glance service trong Openstack


<p align="center"><img  src=http://i.imgur.com/YQbcYBc.png></p>

## 1. Glance là gì?

- Glance là **Image Service** của Openstack bao gồm việc tìm kiếm, thu thập, cung cấp image cho các máy ảo.
- Glance cung cấp RESTful API cho phép quản lý, truy vấn image, metadata.
- Các volume snapshot có thể sử dụng để backup hoặc làm template cho máy ảo mới.
- Glance được thiết kế để có thể là dịch vụ hoạt động độc lập cho sự cần thiết các tổ chức lớn lưu trữ và quản lý các disk image ảo.
- Image của glance có thể được lưu ở nhiều vị trí khác nhau như file system thông thường hay hệ thống lưu trữ object như Swift.
  

## 2. Các thành phần của Glance

Glance bao gồm các thành phần sau:
- **glance-api**: Cung cấp api cho Glance để người dùng hoặc các dịch vụ khác giao tiếp với Glance để gửi các yêu cầu truy vấn, thu thập, lưu trữ image, metadata.
- **glance-registry**: lưu trữ, xử lý và truy vấn metadata của image. Metadata của image sẽ bao gồm các thông tin như kích thước và loại của image.
- **Database**: Để lưu metadata của image, thường dùng MySQL
- **Storage repository cho image**: Có rất nhiều loại được hỗ trợ như filesystem, Object Storage, Rados, Vmware datastore, Http. Lưu ý rằng một số repo chỉ hỗ trợ read-only.
- **Dịch vụ định nghĩa metadata**:  Cho phép nhà cung cấp, quản trị viên, các dịch vụ và người dùng có thể tự định nghĩa metadata tùy chọn. Metadata này có thể sử dụng cho nhiều loại tài nguyên như image, artifacts, volumes, flavor và aggregates.  


## 3. Kiến trúc Glance


![](http://i.imgur.com/g51y366.png)

- Glance có kiến trúc client-server và cung cấp REST API thông qua đó yêu cầu tới server được thực hiện.
- Mọi hoạt động liên quan đến dữ liệu file đều được xử lý bằng thư viện glance_store, mà chịu trách nhiệm giao tiếp với các backend storage.
- Glance hỗ trợ các backend lưu trữ(các driver) sau:
  - **File system**: Glance lưu trữ các image vào hệ thống file thông thường, hỗ trợ đọc ghi file dễ dàng. Thư mục chứa image thường là /var/lib/glance/images/.
  - **HTTP**: Cho phép glance sử dụng các image thông qua giao thức Http nhưng chỉ hỗ trợ chế độ đọc, không thể ghi.
  - **RBD**: Lưu trữ image trong cụm Ceph thông qua RBD interface của Ceph.
  - **Cinder**: Lưu trữ image dưới dạng block trên Block storage Cinder.
  - **Swift**: Lưu trữ image dưới dạng object trên Object Storage Swift
  - **VMware**: Lưu trữ image trên datastore của Vmware
  - **S3**: Hỗ trợ lưu trữ sử  dụng s3.


## 4. Các định dạng image được hỗ trợ trên Glance
Khi upload một image lên Glance ta cần xác định định dạng của image đó. Glance hỗ trợ nhiều loại định dạng disk image và định dạng container image:
**Disk image formart**:
- **aki**: Amazon kernel image
- **ami**: Amazon machine image
- **ari**: Amazon ramdisk image
- **iso**: Định dạng lưu trữ dữ liệu cho đĩa quang ví dụ như CD-ROM
- **qcow2**: Hỗ trợ bởi QEMU 
- **raw** : An unstructured disk image format; if you have a file without an extension it is possibly a raw format.
- **vdi** : Supported by VirtualBox virtual machine monitor and the QEMU emulator.
- **vhd** : The VHD disk format, a common disk format used by virtual machine monitors from VMware, Xen, Microsoft, VirtualBox, and others.
- **vhdx** : The VHDX disk format, an enhanced version of the VHD format, which supports larger disk sizes among other features.
- **vmdk** : Vmware

**Container image format**:
- **aki** : An Amazon kernel image.
- **ami** :An Amazon machine image.
- **ari** : An Amazon ramdisk image.
- **bare**: The image does not have a container or metadata envelope.
- **docker**: A docker container format.
- **ova** :An OVF package in a tarfile.
- **ovf** : The OVF container format.

## 5. Luồng trạng thái của image

Các image trong Glance có thể ở một trong các trạng thái sau:
- **queued**: image ở hàng chờ. Định danh cho image được bảo lưu cho image đó trong Glance Registry. Dữ liệu của image vẫn chưa được tải lên Glance và image size cho image đã được định danh này được thiết lập là 0.
- **saving**: Biểu thị rằng dữ liệu thô của image đang được tải lên glance. Nếu một image được đăng ký vào registry mà có header là x-image-meta-location thì image này sẽ không bao giờ ở trạng thái *saving*.
- **uploading**:
- **importing**: 

Luồng trạng thái của image:

![Ảnh về luồng trạng thái của image trên Glance](./img/image-status.png)



## Nguồn
- https://docs.openstack.org/glance/train/install/get-started.html
- https://docs.openstack.org/glance/train/contributor/architecture.html
- https://docs.openstack.org/glance_store/latest/user/drivers.html
- https://docs.openstack.org/glance/train/user/formats.html
- https://docs.openstack.org/glance/train/user/statuses.html